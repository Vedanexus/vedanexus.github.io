<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Color Merge</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: radial-gradient(circle at top, #1b1f3b, #090b18);
  overflow: hidden;
  touch-action: manipulation;
  font-family: system-ui, sans-serif;
}

canvas {
  display: block;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let W, H;
function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

const COLORS = ["#ff4d6d", "#ffd166", "#4cc9f0", "#9b5de5", "#06d6a0"];
const R = 22;
const GAP = 6;
const COLS = Math.floor(W / (R * 2 + GAP));
const ROWS = Math.floor(H / (R * 2 + GAP));

let grid = [];

function initGrid() {
  grid = [];
  for (let r = 0; r < ROWS; r++) {
    let row = [];
    for (let c = 0; c < COLS; c++) {
      row.push({
        color: COLORS[Math.floor(Math.random() * COLORS.length)],
        alive: true
      });
    }
    grid.push(row);
  }
}

initGrid();

function draw() {
  ctx.clearRect(0, 0, W, H);
  for (let r = 0; r < ROWS; r++) {
    for (let c = 0; c < COLS; c++) {
      const cell = grid[r][c];
      if (!cell.alive) continue;
      const x = c * (R * 2 + GAP) + R + GAP;
      const y = r * (R * 2 + GAP) + R + GAP;
      ctx.beginPath();
      ctx.arc(x, y, R, 0, Math.PI * 2);
      ctx.fillStyle = cell.color;
      ctx.fill();
    }
  }
}

function getCellAt(x, y) {
  const c = Math.floor(x / (R * 2 + GAP));
  const r = Math.floor(y / (R * 2 + GAP));
  if (r < 0 || r >= ROWS || c < 0 || c >= COLS) return null;
  return { r, c };
}

function floodFill(r, c, color, visited = {}) {
  const key = r + "," + c;
  if (visited[key]) return [];
  visited[key] = true;

  const cell = grid[r][c];
  if (!cell || !cell.alive || cell.color !== color) return [];

  let cells = [{ r, c }];
  const dirs = [[1,0],[-1,0],[0,1],[0,-1]];

  for (let [dr, dc] of dirs) {
    const nr = r + dr, nc = c + dc;
    if (grid[nr] && grid[nr][nc]) {
      cells = cells.concat(floodFill(nr, nc, color, visited));
    }
  }
  return cells;
}

canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const cellPos = getCellAt(x, y);
  if (!cellPos) return;

  const { r, c } = cellPos;
  const cell = grid[r][c];
  if (!cell || !cell.alive) return;

  const cluster = floodFill(r, c, cell.color);
  if (cluster.length < 3) return;

  cluster.forEach(p => grid[p.r][p.c].alive = false);
});

function loop() {
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
