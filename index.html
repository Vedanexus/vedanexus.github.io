<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Dark Forest Dodge</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
}
body {
  background: url("bg.jpg") no-repeat center center fixed;
  background-size: cover;
}
body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: radial-gradient(
    circle at center,
    rgba(0,0,0,0.15),
    rgba(0,0,0,0.85)
  );
  pointer-events: none;
}
canvas {
  position: fixed;
  inset: 0;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<audio id="music" src="music.mp3" loop preload="auto" playsinline></audio>
<audio id="hit" src="hit.mp3" preload="auto" playsinline></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let W, H;
function resize(){
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* IMAGES */
const heroImg = new Image(); heroImg.src = "hero.png";
const enemyImg = new Image(); enemyImg.src = "enemy.png";
const bulletImg = new Image(); bulletImg.src = "bullet.png"; // optional

/* AUDIO */
const music = document.getElementById("music");
const hit = document.getElementById("hit");
let musicStarted = false;

/* PLAYER */
const player = {
  x: W/2 - 32,
  y: H - 150,
  w: 64,
  h: 96
};

/* GAME STATE */
let enemies = [];
let bullets = [];
let speed = 3;
let score = 0;
let gameOver = false;
let dragging = false;

/* START MUSIC */
function startMusic(){
  if(musicStarted) return;
  music.muted = true;
  music.play().then(()=>{
    setTimeout(()=>{
      music.muted = false;
      music.volume = 0.35;
    },300);
    musicStarted = true;
  }).catch(()=>{});
}

/* INPUT */
document.addEventListener("pointerdown", e => {
  startMusic();

  if(gameOver){
    enemies = [];
    bullets = [];
    speed = 3;
    score = 0;
    gameOver = false;
    return;
  }

  dragging = true;
  player.x = e.clientX - player.w/2;

  // ðŸ”« SHOOT
  bullets.push({
    x: player.x + player.w/2 - 6,
    y: player.y,
    w: 12,
    h: 20,
    speed: 10
  });
});

document.addEventListener("pointermove", e => {
  if(dragging){
    player.x = e.clientX - player.w/2;
  }
});
document.addEventListener("pointerup", ()=> dragging = false);

/* SPAWN ENEMY */
function spawnEnemy(){
  enemies.push({
    x: Math.random() * (W - 70),
    y: -120,
    w: 70,
    h: 90
  });
}

/* UPDATE */
function update(){
  if(gameOver) return;

  if(Math.random() < 0.03) spawnEnemy();

  enemies.forEach(en => en.y += speed);
  bullets.forEach(b => b.y -= b.speed);

  // COLLISIONS
  bullets.forEach((b, bi) => {
    enemies.forEach((en, ei) => {
      if(
        b.x < en.x + en.w &&
        b.x + b.w > en.x &&
        b.y < en.y + en.h &&
        b.y + b.h > en.y
      ){
        enemies.splice(ei,1);
        bullets.splice(bi,1);
        score += 50;
      }
    });
  });

  // ENEMY HIT HERO
  enemies.forEach(en => {
    if(
      player.x < en.x + en.w &&
      player.x + player.w > en.x &&
      player.y < en.y + en.h &&
      player.y + player.h > en.y
    ){
      hit.currentTime = 0;
      hit.play().catch(()=>{});
      gameOver = true;
    }
  });

  enemies = enemies.filter(e => e.y < H + 200);
  bullets = bullets.filter(b => b.y > -50);

  speed += 0.002;
  score++;
}

/* DRAW */
function draw(){
  ctx.clearRect(0,0,W,H);

  // HERO SPOTLIGHT
  const g = ctx.createRadialGradient(
    player.x + player.w/2,
    player.y + player.h,
    10,
    player.x + player.w/2,
    player.y + player.h,
    140
  );
  g.addColorStop(0,"rgba(255,255,255,0.18)");
  g.addColorStop(1,"rgba(255,255,255,0)");
  ctx.fillStyle = g;
  ctx.beginPath();
  ctx.arc(player.x + player.w/2, player.y + player.h, 140, 0, Math.PI*2);
  ctx.fill();

  // BULLETS
  bullets.forEach(b=>{
    ctx.fillStyle = "rgba(180,220,255,0.9)";
    ctx.fillRect(b.x, b.y, b.w, b.h);
  });

  // ENEMIES
  enemies.forEach(en=>{
    ctx.shadowBlur = 35;
    ctx.shadowColor = "rgba(255,0,0,0.9)";
    ctx.drawImage(enemyImg, en.x, en.y, en.w, en.h);
  });

  // HERO
  ctx.shadowBlur = 25;
  ctx.shadowColor = "rgba(255,255,255,0.85)";
  ctx.drawImage(heroImg, player.x, player.y, player.w, player.h);
  ctx.shadowBlur = 0;

  // UI
  ctx.fillStyle = "white";
  ctx.font = "16px system-ui";
  ctx.fillText("Score: " + score, 12, 22);

  if(gameOver){
    ctx.fillText("YOU WERE CONSUMED", W/2 - 90, H/2);
    ctx.fillText("TAP TO TRY AGAIN", W/2 - 80, H/2 + 24);
  }
}

/* LOOP */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
