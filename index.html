<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Mini Platformer</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: linear-gradient(#87ceeb, #e0f7ff);
  touch-action: none;
}
canvas { display: block; }
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let W, H;
function resize(){
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ===== CONSTANTS ===== */
const GRAVITY = 0.8;
const JUMP = -14;
const SPEED = 4;

/* ===== GAME STATE ===== */
let hero, platforms, coins, camX, score, gameOver;

/* ===== INIT ===== */
function initGame(){
  camX = 0;
  score = 0;
  gameOver = false;

  hero = {
    x: 50,
    y: H - 120,   // HARD SAFE SPAWN
    w: 32,
    h: 40,
    vx: 0,
    vy: 0,
    onGround: true
  };

  platforms = [
    {x: 0,   y: H-80, w: 3000, h: 80},
    {x: 300, y: H-180, w: 140, h: 20},
    {x: 650, y: H-240, w: 140, h: 20},
    {x: 1000,y: H-200, w: 160, h: 20},
    {x: 1400,y: H-260, w: 160, h: 20}
  ];

  coins = [
    {x: 330, y: H-210},
    {x: 680, y: H-270},
    {x: 1030,y: H-230},
    {x: 1430,y: H-290}
  ];
}

initGame();

/* ===== INPUT ===== */
let keys = {};
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

document.addEventListener("pointerdown", (e) => {
  // restart
  if (gameOver) {
    initGame();
    return;
  }

  // jump
  if (hero.onGround) {
    hero.vy = JUMP;
    hero.onGround = false;
  }
});

/* ===== UPDATE ===== */
function update(){
  if(gameOver) return;

  // Horizontal
  hero.vx = 0;
  if(keys["ArrowRight"]) hero.vx = SPEED;
  if(keys["ArrowLeft"]) hero.vx = -SPEED;
  hero.x += hero.vx;

  // Gravity
  hero.vy += GRAVITY;
  hero.y += hero.vy;
  hero.onGround = false;

  // Platform collision (simple + safe)
  for(let p of platforms){
    if(
      hero.x < p.x + p.w &&
      hero.x + hero.w > p.x &&
      hero.y + hero.h > p.y &&
      hero.y + hero.h - hero.vy <= p.y
    ){
      hero.y = p.y - hero.h;
      hero.vy = 0;
      hero.onGround = true;
    }
  }

  // Camera follow
  camX = hero.x - 100;

  // Coins
  coins = coins.filter(c => {
    const hit =
      hero.x < c.x + 16 &&
      hero.x + hero.w > c.x &&
      hero.y < c.y + 16 &&
      hero.y + hero.h > c.y;
    if(hit) score++;
    return !hit;
  });

  // Fall death (ONLY when fully gone)
  if(hero.y > H + 200){
    gameOver = true;
  }
}

/* ===== DRAW ===== */
function draw(){
  ctx.clearRect(0,0,W,H);
  ctx.save();
  ctx.translate(-camX,0);

  // Platforms
  ctx.fillStyle="#654321";
  platforms.forEach(p => ctx.fillRect(p.x,p.y,p.w,p.h));

  // Coins
  ctx.fillStyle="gold";
  coins.forEach(c => {
    ctx.beginPath();
    ctx.arc(c.x+8,c.y+8,8,0,Math.PI*2);
    ctx.fill();
  });

  // Hero
  ctx.fillStyle="#ff4757";
  ctx.fillRect(hero.x,hero.y,hero.w,hero.h);

  ctx.restore();

  // UI
  ctx.fillStyle="#000";
  ctx.font="16px system-ui";
  ctx.fillText("Coins: "+score,10,20);

  if(gameOver){
    ctx.fillText("GAME OVER - TAP TO RESTART",W/2-110,H/2);
  }
}

/* ===== LOOP ===== */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
