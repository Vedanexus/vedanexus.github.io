<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VedaNexus Debug Game</title>
<style>
html,body{margin:0;padding:0;overflow:hidden}
body{background:#000}
canvas{display:block}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
const c=document.getElementById("game");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
addEventListener("resize",resize);resize();

/* STATE */
let gameState="start";
let level=1;
let kills=0;
let targetKills=0;

let player, bullets, enemies, boss;
let shootCooldown=0;
let dragging=false;

/* RESET */
if(gameState==="start"){
  gameState="play";
  level = 1;
  resetGame();
  spawnLevel();   // ðŸ”¥ THIS WAS THE MISSING LINK
  return;
}


/* SPAWN */
function spawnLevel(){
  enemies=[];
  boss=null;
  kills=0;

  if(level===1){
    targetKills=3; // ðŸ”¥ intentionally low for testing
    for(let i=0;i<3;i++){
      enemies.push({x:100+i*80,y:-i*60,w:40,h:40,v:2,dx:0});
    }
  }

  if(level===2){
    targetKills=3;
    for(let i=0;i<3;i++){
      enemies.push({x:100+i*80,y:-i*60,w:40,h:40,v:3,dx:2});
    }
  }

  if(level===3){
    boss={x:c.width/2-60,y:40,w:120,h:120,hp:5,dir:1,speed:2};
  }
}

/* INPUT */
addEventListener("pointerdown",e=>{
  if(gameState==="start"){
    gameState="play";
    level=1;
    resetGame();
    spawnLevel();
    return;
  }

  dragging=true;
  player.x=e.clientX-player.w/2;

  if(shootCooldown===0){
    bullets.push({x:player.x+18,y:player.y,w:4,h:10,v:8});
    shootCooldown=10;
  }
});
addEventListener("pointermove",e=>{
  if(dragging) player.x=e.clientX-player.w/2;
});
addEventListener("pointerup",()=>dragging=false);

/* HIT */
function hit(a,b){
  return a.x<b.x+b.w && a.x+a.w>b.x &&
         a.y<b.y+b.h && a.y+a.h>b.y;
}

/* UPDATE */
function update(){
  if(gameState!=="play") return;
  if(shootCooldown>0) shootCooldown--;

  bullets.forEach(b=>b.y-=b.v);
  enemies.forEach(e=>{
    e.y+=e.v;
    e.x+=e.dx;
    if(e.x<0||e.x+e.w>c.width) e.dx*=-1;
  });

  // bullet -> enemy
  for(let i=bullets.length-1;i>=0;i--){
    for(let j=enemies.length-1;j>=0;j--){
      if(hit(bullets[i],enemies[j])){
        bullets.splice(i,1);
        enemies.splice(j,1);
        kills++;
        break;
      }
    }
  }

  // LEVEL SWITCH (DEBUG SAFE)
  if(level<=2 && kills>=targetKills){
    level++;
    spawnLevel();
  }

  // boss
  if(level===3 && boss){
    boss.x+=boss.dir*boss.speed;
    if(boss.x<0||boss.x+boss.w>c.width) boss.dir*=-1;

    for(let i=bullets.length-1;i>=0;i--){
      if(hit(bullets[i],boss)){
        bullets.splice(i,1);
        boss.hp--;
        if(boss.hp<=0){
          gameState="start";
        }
      }
    }
  }

  bullets=bullets.filter(b=>b.y>-20);
}

/* DRAW */
function draw(){
  ctx.clearRect(0,0,c.width,c.height);

  // DEBUG OVERLAY
  ctx.fillStyle="lime";
  ctx.font="14px monospace";
  ctx.fillText(`LEVEL: ${level}`,10,20);
  ctx.fillText(`KILLS: ${kills} / ${targetKills}`,10,40);
  ctx.fillText(`ENEMIES: ${enemies.length}`,10,60);
  ctx.fillText(`BOSS: ${boss? "YES":"NO"}`,10,80);

  if(gameState==="start"){
    ctx.fillStyle="white";
    ctx.font="24px sans-serif";
    ctx.fillText("TAP TO START",c.width/2-80,c.height/2);
    return;
  }

  ctx.fillStyle="white";
  ctx.fillRect(player.x,player.y,player.w,player.h);

  ctx.fillStyle="cyan";
  bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));

  enemies.forEach(e=>{
    ctx.fillStyle="red";
    ctx.fillRect(e.x,e.y,e.w,e.h);
  });

  if(boss){
    ctx.fillStyle="orange";
    ctx.fillRect(boss.x,boss.y,boss.w,boss.h);
  }
}

/* LOOP */
(function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
