<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VedaNexus Challenge Game</title>

<style>
html,body{margin:0;padding:0;overflow:hidden}
body{background:url("bg.jpg") center/cover no-repeat fixed}
canvas{display:block}
</style>
</head>

<body>
<canvas id="game"></canvas>
<audio id="bgMusic" src="music.mp3" loop playsinline></audio>

<script>
/* ===== CANVAS ===== */
const c=document.getElementById("game"),ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
addEventListener("resize",resize);resize();

/* ===== ASSETS ===== */
const heroImg=new Image(); heroImg.src="hero.png";
const enemyImg=new Image(); enemyImg.src="enemy.png";
const bossImg=new Image();  bossImg.src="boss.png";

/* ===== STATE ===== */
let gameState="start"; // start | play | win
let level=1;
let player, bullets, enemies, boss;
let dragging=false;
let winTimer=0;
let musicStarted=false;
let shootCooldown=0;

/* ===== RESET ===== */
function resetGame(){
  player={x:c.width/2-24,y:c.height-90,w:48,h:48};
  bullets=[];
  enemies=[];
  boss=null;
  winTimer=0;
  shootCooldown=0;
}

/* ===== SPAWN LEVEL ===== */
function spawnLevel(){
  enemies=[];
  boss=null;

  if(level===1){
    for(let i=0;i<8;i++){
      enemies.push({
        x:Math.random()*(c.width-48),
        y:-i*50,
        w:48,h:48,
        v:3
      });
    }
  }

  if(level===2){
    for(let i=0;i<14;i++){
      enemies.push({
        x:Math.random()*(c.width-48),
        y:-i*45,
        w:48,h:48,
        v:4.5,
        dx:Math.random()<0.5?-1.5:1.5
      });
    }
  }

  if(level===3){
    boss={
      x:c.width/2-80,
      y:50,
      w:160,
      h:160,
      hp:40,
      dir:1,
      speed:3
    };
  }
}

/* ===== INPUT ===== */
addEventListener("pointerdown",e=>{
  if(!musicStarted){
    bgMusic.volume=0.4;
    bgMusic.play().catch(()=>{});
    musicStarted=true;
  }

  if(gameState==="start"){
    level=1;
    resetGame();
    spawnLevel();
    gameState="play";
    return;
  }

  if(gameState==="win"){
    gameState="start";
    return;
  }

  dragging=true;
  player.x=e.clientX-player.w/2;

  if(shootCooldown===0){
    bullets.push({x:player.x+22,y:player.y,w:4,h:12,v:10});
    shootCooldown=15;
  }
});
addEventListener("pointermove",e=>{
  if(gameState==="play"&&dragging)
    player.x=e.clientX-player.w/2;
});
addEventListener("pointerup",()=>dragging=false);

/* ===== COLLISION ===== */
function hit(a,b){
  return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;
}

/* ===== UPDATE ===== */
function update(){
  if(gameState!=="play") return;

  if(shootCooldown>0) shootCooldown--;

  bullets.forEach(b=>b.y-=b.v);
  enemies.forEach(e=>{
    e.y+=e.v;
    if(e.dx){
      e.x+=e.dx;
      if(e.x<0||e.x+e.w>c.width) e.dx*=-1;
    }
  });

  // bullets â†’ enemies
  for(let i=bullets.length-1;i>=0;i--){
    for(let j=enemies.length-1;j>=0;j--){
      if(hit(bullets[i],enemies[j])){
        bullets.splice(i,1);
        enemies.splice(j,1);
        break;
      }
    }
  }

  /* ===== LEVEL PROGRESSION ===== */
  if(level<=2 && enemies.length===0){
    level++;
    spawnLevel();
    // â— RETURN ONLY FOR LEVEL 1 & 2
    return;
  }

  /* ===== BOSS LOGIC ===== */
  if(level===3 && boss){
    boss.x+=boss.dir*boss.speed;
    if(boss.x<20||boss.x+boss.w>c.width-20) boss.dir*=-1;

    for(let i=bullets.length-1;i>=0;i--){
      const b=bullets[i];
      const cx=boss.x+boss.w*0.3;
      const cy=boss.y+boss.h*0.3;
      const cw=boss.w*0.4;
      const ch=boss.h*0.4;

      if(b.x<cx+cw&&b.x+b.w>cx&&b.y<cy+ch&&b.y+b.h>cy){
        bullets.splice(i,1);
        boss.hp--;
        if(boss.hp<=0){
          boss=null;
          winTimer=60;
          break;
        }
      }
    }
  }

  if(winTimer>0){
    winTimer--;
    if(winTimer===0) gameState="win";
  }

  bullets=bullets.filter(b=>b.y>-20);
}

/* ===== DRAW ===== */
function draw(){
  ctx.clearRect(0,0,c.width,c.height);

  if(gameState==="start"){
    ctx.fillStyle="white";
    ctx.font="24px system-ui";
    ctx.fillText("Tap to Start",c.width/2-70,c.height/2);
    ctx.font="14px system-ui";
    ctx.fillText("Built by VedaNexus",c.width/2-65,c.height/2+30);
    return;
  }

  if(gameState==="win"){
    ctx.fillStyle="rgba(0,0,0,0.7)";
    ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle="white";
    ctx.font="28px system-ui";
    ctx.fillText("ðŸŽ‰ YOU QUALIFIED ðŸŽ‰",c.width/2-110,c.height/2);
    ctx.font="16px system-ui";
    ctx.fillText("Top players only",c.width/2-60,c.height/2+30);
    ctx.fillText("Powered by VedaNexus",c.width/2-80,c.height/2+55);
    return;
  }

  ctx.drawImage(heroImg,player.x,player.y,player.w,player.h);
  ctx.fillStyle="cyan";
  bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));
  enemies.forEach(e=>ctx.drawImage(enemyImg,e.x,e.y,e.w,e.h));

  if(boss){
    ctx.drawImage(bossImg,boss.x,boss.y,boss.w,boss.h);
    ctx.fillStyle="red";
    ctx.fillRect(boss.x,boss.y-10,boss.w*(boss.hp/40),6);
  }

  ctx.font="12px system-ui";
  ctx.fillStyle="rgba(255,255,255,0.4)";
  ctx.fillText("VedaNexus",c.width-90,c.height-15);
}

/* ===== LOOP ===== */
(function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
