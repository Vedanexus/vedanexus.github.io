<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Guaranteed Progression Test</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#111}
canvas{display:block}
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const c = document.getElementById("game");
const ctx = c.getContext("2d");
function resize(){ c.width=innerWidth; c.height=innerHeight }
addEventListener("resize",resize); resize();

/* ===== STATE ===== */
let gameState = "start"; // start | play | win
let level = 1;
let timer = 0;

let player = {x:0,y:0,w:40,h:40};
let enemies = [];
let boss = null;

/* ===== SPAWN ===== */
function spawnLevel(){
  enemies = [];
  boss = null;
  timer = 0;

  if(level === 1){
    for(let i=0;i<5;i++){
      enemies.push({x:80+i*60,y:60,w:40,h:40});
    }
  }
  if(level === 2){
    for(let i=0;i<5;i++){
      enemies.push({x:80+i*60,y:120,w:40,h:40});
    }
  }
  if(level === 3){
    boss = {x:c.width/2-80,y:80,w:160,h:120,hp:10};
  }
}

/* ===== INPUT ===== */
addEventListener("pointerdown",()=>{
  if(gameState==="start"){
    gameState="play";
    level=1;
    spawnLevel();
  }else if(gameState==="win"){
    gameState="start";
  }
});

/* ===== UPDATE ===== */
function update(){
  if(gameState!=="play") return;

  timer++;

  // AUTO PROGRESSION BY TIME (GUARANTEE)
  if(level===1 && timer>120){ // ~2 sec
    level=2; spawnLevel();
  }
  if(level===2 && timer>120){
    level=3; spawnLevel();
  }
  if(level===3 && timer>180){
    gameState="win";
  }
}

/* ===== DRAW ===== */
function draw(){
  ctx.clearRect(0,0,c.width,c.height);

  ctx.fillStyle="#fff";
  ctx.font="18px sans-serif";
  ctx.fillText("LEVEL: "+level,10,24);
  ctx.fillText("TIMER: "+timer,10,48);

  if(gameState==="start"){
    ctx.fillText("TAP TO START",c.width/2-70,c.height/2);
    return;
  }
  if(gameState==="win"){
    ctx.fillText("WIN SCREEN",c.width/2-60,c.height/2);
    return;
  }

  // player
  ctx.fillStyle="cyan";
  ctx.fillRect(c.width/2-20,c.height-70,40,40);

  // enemies
  ctx.fillStyle="red";
  enemies.forEach(e=>ctx.fillRect(e.x,e.y,e.w,e.h));

  // boss
  if(boss){
    ctx.fillStyle="orange";
    ctx.fillRect(boss.x,boss.y,boss.w,boss.h);
  }
}

/* ===== LOOP ===== */
(function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
