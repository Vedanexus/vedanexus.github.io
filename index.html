<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Dark Dodge</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
}
video {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: -2;
}
canvas {
  position: fixed;
  inset: 0;
}
</style>
</head>

<body>

<!-- REAL VIDEO BACKGROUND -->
<video id="bg" autoplay muted loop playsinline>
  <source src="bg.mp4" type="video/mp4">
</video>

<canvas id="game"></canvas>

<!-- REAL AUDIO -->
<audio id="music" src="music.mp3" loop></audio>
<audio id="hit" src="hit.mp3"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let W = canvas.width = innerWidth;
let H = canvas.height = innerHeight;
onresize = () => {
  W = canvas.width = innerWidth;
  H = canvas.height = innerHeight;
};

/* LOAD REAL IMAGES */
const heroImg = new Image();
heroImg.src = "hero.png";

const enemyImg = new Image();
enemyImg.src = "enemy.png";

/* SOUND */
const music = document.getElementById("music");
const hit = document.getElementById("hit");
let soundStarted = false;

/* PLAYER */
const player = { x: W/2, y: H-120, w: 50, h: 80 };

/* ENEMIES */
let enemies = [];
let speed = 3;
let score = 0;
let gameOver = false;

/* INPUT */
let dragging = false;

document.addEventListener("pointerdown", e => {
  if (!soundStarted) {
    music.volume = 0.4;
    music.play().catch(()=>{});
    soundStarted = true;
  }

  if (gameOver) {
    enemies = [];
    speed = 3;
    score = 0;
    gameOver = false;
    return;
  }

  dragging = true;
  player.x = e.clientX - player.w/2;
});

document.addEventListener("pointermove", e => {
  if (dragging) player.x = e.clientX - player.w/2;
});
document.addEventListener("pointerup", () => dragging = false);

/* SPAWN */
function spawnEnemy(){
  enemies.push({
    x: Math.random()*(W-60),
    y: -100,
    w: 60,
    h: 80
  });
}

/* LOOP */
function update(){
  if (gameOver) return;

  if (Math.random() < 0.03) spawnEnemy();

  enemies.forEach(en => {
    en.y += speed;

    if (
      player.x < en.x + en.w &&
      player.x + player.w > en.x &&
      player.y < en.y + en.h &&
      player.y + player.h > en.y
    ) {
      hit.play().catch(()=>{});
      gameOver = true;
    }
  });

  enemies = enemies.filter(e => e.y < H+200);
  speed += 0.002;
  score++;
}

function draw(){
  ctx.clearRect(0,0,W,H);

  enemies.forEach(en => {
    ctx.drawImage(enemyImg, en.x, en.y, en.w, en.h);
  });

  ctx.drawImage(heroImg, player.x, player.y, player.w, player.h);

  ctx.fillStyle = "white";
  ctx.fillText("Survival: "+score, 10, 20);

  if (gameOver) {
    ctx.fillText("GAME OVER - TAP TO RESTART", W/2-120, H/2);
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
