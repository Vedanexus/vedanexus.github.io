<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PL6RCL2113"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-PL6RCL2113');
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VedaNexus Game</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background:
        linear-gradient(rgba(0,0,0,0.35), rgba(0,0,0,0.35)),
        url("bg.jpg") center / cover no-repeat fixed;
      font-family: Arial, sans-serif;
    }
    canvas { display:block; }
    #backBtn{
  position:fixed;
  top:15px;
  left:15px;
  z-index:9999;
  background:rgba(0,0,0,0.6);
  color:#ffd700;
  padding:8px 14px;
  border-radius:6px;
  font-size:14px;
  text-decoration:none;
  backdrop-filter: blur(6px);
}

#backBtn:hover{
  background:#ffd700;
  color:#000;
}

  </style>
</head>

<body>
<canvas id="game"></canvas>
  
<a href="index.html" id="backBtn" onclick="bgMusic.pause()">‚Üê Back to VedaNexus</a>

<script>
/* ========= GA ========= */
function trackEvent(name){
  if(typeof gtag === "function"){
    gtag("event", name);
  }
}

/* ========= SOUNDS ========= */
const bgMusic = new Audio("sounds/bg.mp3");
bgMusic.loop = true;
bgMusic.volume = 0.25;

const shootSound = new Audio("sounds/shoot.mp3");
const explodeSound = new Audio("sounds/explode.mp3");
const gameOverSound = new Audio("sounds/gameover.mp3");
const winSound = new Audio("sounds/win.mp3");

let soundEnabled = true;
let playerName = localStorage.getItem("vn_player_name");

function askPlayerName(){
  if(!playerName){
    playerName = prompt("Enter your name (Leaderboard ke liye):");
    
    if(!playerName || playerName.trim()===""){
      playerName = "Guest";
    }

    playerName = playerName.substring(0,12); // limit length
    localStorage.setItem("vn_player_name", playerName);
  }
}


/* ========= LEADERBOARD ========= */
function saveScoreOnce(score){
  let saved = JSON.parse(localStorage.getItem("vn_saved")) || false;
  if(saved) return;

  let scores = JSON.parse(localStorage.getItem("vn_scores")) || [];

  scores.push({
    name: playerName || "Guest",
    score: score,
    time: new Date().toLocaleString()
  });

  scores.sort((a,b)=>b.score-a.score);
  scores = scores.slice(0,10);

  localStorage.setItem("vn_scores", JSON.stringify(scores));
  localStorage.setItem("vn_saved", "true");
}

function getScores(){
  return JSON.parse(localStorage.getItem("vn_scores")) || [];
}

/* ========= CANVAS ========= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let W = innerWidth;
let H = innerHeight;

function resize(){
  const dpr = devicePixelRatio || 1;
  W = innerWidth;
  H = innerHeight;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  canvas.style.width = W+"px";
  canvas.style.height = H+"px";
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
addEventListener("resize", resize);
resize();

/* ========= ASSETS ========= */
const heroImg = new Image();
heroImg.src = "hero.png";

const enemyImg = new Image();
enemyImg.src = "enemy_laptop.png";

/* ========= PLAYER ========= */
const player = { x:W/2-24, y:H-80, w:48, h:48 };

/* ========= GAME STATE ========= */
let bullets=[], enemies=[], explosions=[];
let score=0, ammo=300;
const WIN_SCORE=300;
let gameState="PLAY";
let fireCooldown=0, isFiring=false, hintTimer=0;
  
/* ===== KEYBOARD STATE ===== */
let keyLeft = false;
let keyRight = false;
let keyShoot = false;

/* ========= INPUT ========= */
addEventListener("pointerdown", e=>{
  if(e.clientX>W-50 && e.clientY<50){
    soundEnabled=!soundEnabled;
    [bgMusic,shootSound,explodeSound,gameOverSound,winSound]
      .forEach(s=>s.muted=!soundEnabled);
    if(!soundEnabled){ bgMusic.pause(); bgMusic.currentTime=0; }
    return;
  }

  if(soundEnabled && bgMusic.paused) bgMusic.play().catch(()=>{});

  if(gameState!=="PLAY"){
    if(e.clientY>H/2+70 && e.clientY<H/2+100){
      location.href="about.html";
      return;
    }
    restartGame();
    return;
  }

  isFiring=true;
  player.x=e.clientX-player.w/2;
});

addEventListener("pointermove",e=>{
  if(isFiring) player.x=e.clientX-player.w/2;
});
addEventListener("pointerup",()=>isFiring=false);
/* ===== KEYBOARD CONTROLS ===== */
window.addEventListener("keydown", e => {
  if(e.code === "ArrowLeft") keyLeft = true;
  if(e.code === "ArrowRight") keyRight = true;
  if(e.code === "Space") keyShoot = true;
});

window.addEventListener("keyup", e => {
  if(e.code === "ArrowLeft") keyLeft = false;
  if(e.code === "ArrowRight") keyRight = false;
  if(e.code === "Space") keyShoot = false;
});

/* prevent space scroll */
window.addEventListener("keydown", e => {
  if(e.code === "Space") e.preventDefault();
});


/* ========= ENEMY SPAWN ========= */
setInterval(()=>{
  if(gameState!=="PLAY") return;
  enemies.push({
    x:Math.random()*(W-44),
    y:-44,
    w:44,h:44,
    speed:Math.min(2+score*0.05,14)
  });
},700);

/* ========= HELPERS ========= */
function hit(a,b){
  return a.x<b.x+b.w && a.x+a.w>b.x &&
         a.y<b.y+b.h && a.y+a.h>b.y;
}

function boom(x,y){
  for(let i=0;i<12;i++)
    explosions.push({x,y,vx:(Math.random()-.5)*6,vy:(Math.random()-.5)*6,life:20});
}

/* ========= UPDATE ========= */
function update(){
  /* ===== KEYBOARD MOVE ===== */
const SPEED = 6;

if(keyLeft){
  player.x -= SPEED;
}
if(keyRight){
  player.x += SPEED;
}

// screen boundary lock
if(player.x < 0) player.x = 0;
if(player.x + player.w > W) player.x = W - player.w;

  if(gameState !== "PLAY") return;

  if((isFiring || keyShoot) && fireCooldown<=0 && ammo>0){


    bullets.push({x:player.x+22,y:player.y,w:6,h:12,speed:8});
    ammo--; fireCooldown=10;
    if(soundEnabled){shootSound.currentTime=0;shootSound.play().catch(()=>{});}
  }
  if(fireCooldown>0) fireCooldown--;

  bullets.forEach(b=>b.y-=b.speed);
  enemies.forEach(e=>e.y+=e.speed);

  explosions.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.life--;});
  explosions=explosions.filter(p=>p.life>0);

  for(let i=bullets.length-1;i>=0;i--){
    for(let j=enemies.length-1;j>=0;j--){
      if(hit(bullets[i],enemies[j])){
        boom(enemies[j].x+22,enemies[j].y+22);
        bullets.splice(i,1); enemies.splice(j,1);
        score++;
        if(soundEnabled){explodeSound.currentTime=0;explodeSound.play().catch(()=>{});}
        if(score>=WIN_SCORE){
          gameState="WIN";
          trackEvent("game_win"); 
          saveScoreOnce(score);
          bgMusic.pause();
          if(soundEnabled) winSound.play().catch(()=>{});
        }
        break;
      }
    }
  }

  for(let e of enemies){
    if(hit(player,e)){
      gameState="OVER";
      trackEvent("game_over"); 
      saveScoreOnce(score);
      bgMusic.pause();
      if(soundEnabled) gameOverSound.play().catch(()=>{});
    }
  }

  bullets=bullets.filter(b=>b.y>-20);
  enemies=enemies.filter(e=>e.y<H+40);
}

/* ========= DRAW ========= */
function draw(){
  ctx.clearRect(0,0,W,H);

  ctx.fillStyle="#fff";
  ctx.font="20px Arial";
  ctx.textAlign="left";
  ctx.fillText(`Score: ${score}`,20,40);
  ctx.fillText(`Ammo: ${ammo}`,20,70);
  ctx.textAlign="right";
  ctx.fillText(soundEnabled?"üîä":"üîá",W-15,30);

  ctx.drawImage(heroImg,player.x,player.y,player.w,player.h);
  ctx.fillStyle="yellow";
  bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));
  explosions.forEach(p=>{
    ctx.fillStyle=`rgba(255,180,50,${p.life/20})`;
    ctx.beginPath(); ctx.arc(p.x,p.y,4,0,Math.PI*2); ctx.fill();
  });
  enemies.forEach(e=>ctx.drawImage(enemyImg,e.x,e.y,e.w,e.h));

  if(gameState!=="PLAY"){
    ctx.textAlign="center";
    ctx.font="48px Arial";
    ctx.fillText(gameState==="WIN"?"YOU WIN":"GAME OVER",W/2,H/2);
    ctx.font="20px Arial";
    ctx.fillText("Tap to Restart",W/2,H/2+40);
    ctx.fillText("About VedaNexus",W/2,H/2+80);

    const scores=getScores();
    ctx.font="22px Arial";
    ctx.fillText("üèÜ TOP PLAYERS",W/2,H/2+130);
    scores.forEach((s,i)=>{
      ctx.fillText(`${i+1}. ${s.name} - ${s.score}`, W/2, H/2 + 165 + i * 24);

    });

    ctx.font = "14px Arial";
    ctx.textAlign = "center";
    ctx.fillStyle = "#ccc";
    ctx.fillText("Controls: ‚Üê ‚Üí  +  Space", W/2, H - 15);
  }
}

/* ========= LOOP ========= */
function loop(){ update(); draw(); requestAnimationFrame(loop); }
  askPlayerName();
  trackEvent("game_start");
loop();

/* ========= RESET ========= */
function restartGame(){
  askPlayerName();

  bullets=[]; enemies=[]; explosions=[];
  score=0; ammo=300; fireCooldown=0;
  gameState="PLAY";
  localStorage.removeItem("vn_saved");
}
</script>
</body>
</html>
